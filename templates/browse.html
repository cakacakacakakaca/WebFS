{% extends "base.html" %}
{% set title = (rel_path if rel_path else "æ ¹ç›®å½•") ~ " - WebFS" %}
{% block content %}

<div class="panel">
  <div class="panel__title">
    <div>
      <div class="h1">{{ rel_path if rel_path else "æ ¹ç›®å½•" }}</div>
      <div class="muted small">
        æ–‡ä»¶æ•°ï¼š{{ stats.total_files }}ï¼Œå›¾ç‰‡ï¼š{{ stats.image_files }}ï¼Œ
        å›¾ç‰‡å æ¯”ï¼š{{ (stats.image_ratio * 100) | round(0) }}%
        {% if image_mode %}
          Â· å·²å¯ç”¨å›¾ç‰‡æµè§ˆæ¨¡å¼
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% if can_upload %}
<div class="panel" style="margin-top:12px;">
  <div class="panel__title">
    <div>
      <div class="h1">ä¸Šä¼ åˆ°å½“å‰ç›®å½•</div>
      <div class="muted small">é€‰æ‹©æ–‡ä»¶åä¸Šä¼ ï¼ˆä¼šå†™å…¥å½“å‰æµè§ˆçš„æ–‡ä»¶å¤¹ï¼‰</div>
    </div>
  </div>
  <form class="upload" action="/upload/{{ rel_path|url_path }}" method="post" enctype="multipart/form-data">
    <input type="file" name="file" required />
    <button class="btn" type="submit">ä¸Šä¼ </button>
  </form>
</div>
{% endif %}

{% if image_mode %}
  <div class="gallery">
    {% for e in entries %}
      {% if not e.is_dir and e.kind == "image" %}
        <a class="thumb" href="/open/{{ e.rel_path|url_path }}">
          <img loading="lazy" src="/thumb/{{ e.rel_path|url_path }}?w=420&h=420" alt="{{ e.name }}"/>
          <div class="thumb__name">{{ e.name }}</div>
        </a>
      {% endif %}
      {% if e.is_dir %}
        <a class="foldercard" href="/browse/{{ e.rel_path|url_path }}">
          <div class="icon">ğŸ“</div>
          <div class="foldercard__meta">
            <div class="name">{{ e.name }}</div>
            <div class="muted small">{{ e.mtime_str }}</div>
          </div>
        </a>
      {% endif %}
    {% endfor %}
  </div>
{% else %}
  <div class="list">
    <div class="table">
      <div class="row head">
        <div class="cell name">åç§°</div>
        <div class="cell size">å¤§å°</div>
        <div class="cell time">ä¿®æ”¹æ—¶é—´</div>
      </div>
      {% for e in entries %}
        <div class="row">
          <div class="cell name">
            {% if e.is_dir %}
              <a class="item" href="/browse/{{ e.rel_path|url_path }}">
                <span class="ico">ğŸ“</span><span class="txt">{{ e.name }}</span>
              </a>
            {% else %}
              <a class="item" href="/open/{{ e.rel_path|url_path }}">
                <span class="ico">
                  {% if e.kind == "image" %}ğŸ–¼ï¸{% elif e.kind == "video" %}ğŸ¬{% else %}ğŸ“„{% endif %}
                </span>
                <span class="txt">{{ e.name }}</span>
              </a>
            {% endif %}
          </div>
          <div class="cell size">{{ e.size_str if not e.is_dir else "-" }}</div>
          <div class="cell time">{{ e.mtime_str }}</div>

          <div class="mobile-actions">
            {% if e.is_dir %}
              <a class="btn btn--small" href="/browse/{{ e.rel_path|url_path }}">æ‰“å¼€</a>
            {% else %}
              <a class="btn btn--small" href="/open/{{ e.rel_path|url_path }}">é¢„è§ˆ</a>
              {% if can_download %}
                <a class="btn btn--small btn--ghost" href="/raw/{{ e.rel_path|url_path }}?download=1">ä¸‹è½½</a>
              {% endif %}
              {% if can_delete %}
                <form method="post" action="/delete/{{ e.rel_path|url_path }}" onsubmit="return confirm('ç¡®è®¤åˆ é™¤è¯¥æ–‡ä»¶ï¼Ÿ')">
                  <button class="btn btn--small" type="submit">åˆ é™¤</button>
                </form>
              {% endif %}
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}

{% endblock %}
